# KiCadデータ

## 回路

### メインボード
- CPU : ESP32S3
- Battery : 3.7V 400mAh

![Phox-MB](image/MB.jpg)
- PhoxのメインボードにはESP32S3を用いている
  - ESP32S3は、ビルドインのUSBシリアル変換を用いることでプログラム可能な構成としている
  - なお、書き込みデバイスについてであるが、私の環境ではUSB-Cの半田付けが上手くできなかったため、一般的なUSBケーブルを切って、XHを打ったものを用いている
- カメラモジュールの部分は[ESP32-S3 EYE MB_V2.2](https://dl.espressif.com/dl/schematics/SCH_ESP32-S3-EYE-MB_20211201_V2.2.pdf)を参考に作成してある
- カメラはOV5640を用いる想定になっている
  - OV5640は、OV2640と違いDC1.2Vを必要としないため、個人でESPカメラを自作する際には回路設計の負担が減り、おすすめである
  - OV5640のモジュールは国内であればAmazon、国外であればAliExpressで沢山見つけることができる
- このメインボードでは、実装面積をできるだけ小さくするために4層基板を用いている
- 基板製造はJLCPCBにて行った
  - 個人的にはJLCPCBで作成した基板でパターンがつながっていなかったりしたことがないのでJLCPCBはおすすめである
  - 4層基板であっても5枚で$7(日本円で1,100円)程度製造可能である
- また、部品点数およびサイズが小さかったためリフロー半田付けを行った
  - この際にステンシルがあるとソルダーペーストを載せる時間を大幅に短縮できとても良い
    - が、ステンシルはそれなりに高価なのでお金と時間を考えて相対効果の高いほうを選ぶのが得策だろう
  - リフローの方法についてはGoogleで探せばいろいろ見つかるだろうし、あまり私がやっている方法は推奨されないのでここには記さないこととする
- 完成した基板にUSBをつなげて、Arduino IDE上でCOMポートが認識されていれば問題なし
- IDEでボードの種類をeps32->「ESP32S3 Dev Module」で選択し、[CameraServer](CameraWebServer_Phox_version)を書き込んでシリアルモニタに表示されたhttpアドレスにアクセスし、「Start Stream」をクリックして、カメラの画像が表示されれば基板完成となる

### ドアスイッチモジュール
- PhoxのMBのスイッチング用の磁気スイッチと測距センサを備えたモジュール
- 磁気スイッチにはALPSALPINE社のHGDEST021Bを用いている
  - このMEMSデバイスはALPSALPINE社から直接ご提供いただいた
- 測距センサにはSTMicro社のVL53L0xを用いている
  - このVL53L0xは電源電圧がOV5640と同じ2.8Vであり、非常に使いやすい
- Drawingを見てもらえば分かると思うが、このモジュールはドア近くに付けるという特性上、小型であることが求められるため、幅に関してはPH6ピンコネクタベースと同程度となっている

### LEDユニット
- 郵便受け内が暗くなりがちであることから適切に画像認識を行うためにPhoxにはLEDユニットが搭載されている
- この回路はLEDを並列につなげたものであるため、詳しい説明は省かせていただく